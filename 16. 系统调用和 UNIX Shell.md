
## ç³»ç»Ÿè°ƒç”¨
ç®¡é“ï¼šä¸€ä¸ªç‰¹æ®Šçš„ â€œæ–‡ä»¶â€ (æµ)  
ç”±è¯»è€…/å†™è€…å…±äº«  
* è¯»å£ï¼šæ”¯æŒ read
* å†™å£ï¼šæ”¯æŒ write

åŒ¿åç®¡é“


## 16.2 æ“ä½œç³»ç»Ÿçš„å¤–å£³ Shell
Everything is a state machine  
æ“ä½œç³»ç»Ÿ = å¯¹è±¡ + API  
æ“ä½œç³»ç»Ÿ = C ç¨‹åº

### The Shell Programming Language

**åŸºäºæ–‡æœ¬æ›¿æ¢çš„å¿«é€Ÿå·¥ä½œæµæ­å»º**  
* é‡å®šå‘: cmd > file < file 2> /dev/null  
* é¡ºåºç»“æ„: cmd1; cmd2, cmd1 && cmd2, cmd1 || cmd2  
* ç®¡é“: cmd1 | cmd2  
* é¢„å¤„ç†: $(), <()  
* å˜é‡/ç¯å¢ƒå˜é‡ã€æ§åˆ¶æµâ€¦â€¦  

**Job control**  
* ç±»æ¯”çª—å£ç®¡ç†å™¨é‡Œçš„ â€œå‰â€ã€â€œæœ€å°åŒ–â€  
* jobs, fg, bg, wait  
(ä»Šå¤©çš„ GUI å¹¶æ²¡æœ‰æ¯” CLI å¤šåšå¤ªå¤šäº‹)


äººå·¥æ™ºèƒ½æ—¶ä»£ï¼Œæˆ‘ä»¬ä¸ºä»€ä¹ˆè¿˜è¦è¯»æ‰‹å†Œï¼Ÿ

## 16.3 å¤åˆ»ç»å…¸ã€å±•æœ›æœªæ¥
### å®ç°è‡ªå·±çš„shell

è¿›ç¨‹ç®¡ç†
å†…å­˜ç®¡ç†
æ–‡ä»¶è°ƒç”¨
è¿›ç¨‹é—´é€šä¿¡

### é˜…è¯»ä»£ç 
åº”è¯¥å¦‚ä½•é˜…è¯»ä»£ç ï¼Ÿ  

strace  
* é€‚å½“çš„åˆ†å±å’Œè¿‡æ»¤
* AI ä½¿é˜…è¯»æ–‡æ¡£çš„æˆæœ¬å¤§å¹…é™ä½

gdb   
* AskGPT: How to debug a process that forks children processes in gdb?
AI ä¹Ÿå¯ä»¥å¸®ä½ è§£é‡Š (ä¸ç”¨å»æ·˜æ–‡æ¡£äº†)
* ä»¥åŠï¼Œå®šåˆ¶çš„ visualization
å¯¹äº Shellï¼Œæˆ‘ä»¬åº”è¯¥æ˜¾ç¤ºä»€ä¹ˆï¼Ÿ

 while | head -n 1

```
Freestanding Shell: è¿™ä¸ª Shell æ²¡æœ‰å¼•ç”¨ä»»ä½•åº“æ–‡ä»¶â€”â€”å®ƒåªé€šè¿‡ç³»ç»Ÿè°ƒç”¨è®¿é—®æ“ä½œç³»ç»Ÿä¸­çš„å¯¹è±¡ã€‚ä¸ºäº†ä¾¿äºè°ƒè¯•ï¼Œæˆ‘ä»¬ç¼–å†™äº† Python è„šæœ¬ï¼Œæ‰“å°å‡ºå½“å‰æ‰€æœ‰è¢«è°ƒè¯•è¿›ç¨‹æ‰“å¼€çš„æ–‡ä»¶ï¼ŒåŒ…æ‹¬è¯»å†™æƒé™å’Œæ–‡ä»¶ã€‚æ²¡é”™â€”â€”è¿›ç¨‹çš„ä»»ä½•ç¬é—´éƒ½èƒ½è¡¨ç¤ºæˆçŠ¶æ€æœºçš„çŠ¶æ€ï¼ŒåŒ…æ‹¬æŒ‡å‘æ“ä½œç³»ç»Ÿå¯¹è±¡çš„æŒ‡é’ˆ (æ–‡ä»¶æè¿°ç¬¦)ã€‚


Take-away Messages
é€šè¿‡ freestanding çš„ shellï¼Œæˆ‘ä»¬é˜é‡Šäº† â€œå¯ä»¥åœ¨ç³»ç»Ÿè°ƒç”¨ä¸Šåˆ›å»ºæ•´ä¸ªæ“ä½œç³»ç»Ÿåº”ç”¨ä¸–ç•Œâ€ çš„çœŸæ­£å«ä¹‰ï¼š
æ“ä½œç³»ç»Ÿçš„ API å’Œåº”ç”¨ç¨‹åºæ˜¯äº’ç›¸æˆå°±ã€èºæ—‹ç”Ÿé•¿çš„ï¼šæœ‰äº†æ–°çš„åº”ç”¨éœ€æ±‚ï¼Œå°±æœ‰äº†æ–°çš„æ“ä½œç³»ç»ŸåŠŸèƒ½ã€‚è€Œ UNIX ä¸ºæˆ‘ä»¬æä¾›äº†ä¸€ä¸ªéå¸¸ç²¾ç®€ã€ç¨³å®šçš„æ¥å£ (fork, execve, exit, pipe ,...)ï¼Œçºµç„¶æœ‰æ²‰é‡çš„å†å²è´Ÿæ‹…ï¼Œå®ƒåœ¨ä»Šå¤©ä¾ç„¶å·¥ä½œå¾—å¾ˆå¥½ã€‚

è¯¾åä¹ é¢˜/ç¼–ç¨‹ä½œä¸š
1. é˜…è¯»ææ–™
ğŸ“šé˜…è¯»ææ–™
æ•™ç§‘ä¹¦ Operating Systems: Three Easy Pieces:

ç¬¬ 5 ç«  - Process API (ç»§ç»­é˜…è¯»)
2. ç¼–ç¨‹å®è·µ
Freestanding shell å¾ˆå¥½åœ°æ­å¼€äº†æ“ä½œç³»ç»Ÿä¸Šåº”ç”¨ç¨‹åºçš„ â€œçœŸé¢ç›®â€ï¼›ç†è§£ sh.c (åŒ…æ‹¬ä½¿ç”¨æ­£ç¡®çš„å·¥å…·) æ˜¯éå¸¸é‡è¦çš„ï¼Œå› æ­¤æˆ‘ä»¬ç‰¹åˆ«åœ¨æ­¤ä¸€æã€‚

